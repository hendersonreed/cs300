<html>
<meta charset="utf-8" />
<head>
</head>
<script src="mapLoad.js"></script>
<script src="cellLoad.js"></script>

<script>
	/*
		File: Frupal.html
		Authors: Henderson Hummel
		Date 10/27/2018

		Purpose: display the game to user.
		Description: This is our managing javascript section, as well as the
		page source. It's exceedingly preliminary, so much of this will change.
		Also! This page is in active development, so if you're reading this 
		because the page is broken, well, that's to be expected.
	*/
const MAX = 20;
	var game = {
		x_coord : 0,
		y_coord : 0,
        mapString: "",
		localStorage.setItem('x_coord', x_coord);
		localStorage.setItem('y_coord', y_coord);

		jewels : {x: Math.round((Math.random() * 1000) % (MAX + 1)), y: Math.round((Math.random() * 1000) % (MAX + 1))},

		//setting up the initial cell contents div.
		go : function(direc) {
			switch(direc) {
				case 'n':
					this.goNorth();
					break;
				case 'e':
					this.goEast();
					break;
				case 'w':
					this.goWest();
					break;
				case 's':
					this.goSouth();
					break;
				default:
					this.y_coord = 0;
					this.x_coord = 0;
					break;
			}
			this.dispLoc();
			this.checkLoc();
            this.displayMap();
			if(this.atJewels())
				alert("You've found the jewels!");
		},

		dispLoc : function() {
			document.getElementById("loc").innerHTML = "Current Location:  " + this.x_coord + ',' + this.y_coord;
		},

		checkLoc : function() {
			var cellContents = localStorage.getItem(this.x_coord + ',' + this.y_coord);
			if(cellContents != null) {
				document.getElementById("cell").innerHTML = "Cell Details: " + cellContents;
			}
			else {
				document.getElementById("cell").innerHTML = "Cell Details: 0,0,0,0,None";
			}
		},

		atJewels : function() {
			if((this.x_coord == this.jewels.x) && (this.y_coord == this.jewels.y))
				return true;
			return false
		},
		
		goNorth : function() {
			if(this.x_coord > 0) {
				--this.x_coord;
			}
			else {
				this.x_coord = MAX;
			}
		},

		goEast : function() {
			if(this.y_coord < MAX) {
				++this.y_coord;
			}
			else {
				this.y_coord = 0;
			}
		},

		goWest : function() {
			if(this.y_coord > 0) {
				--this.y_coord;
			}
			else {
				this.y_coord = MAX;
			}
		},

		goSouth : function() {
			if(this.x_coord < MAX) {
				++this.x_coord;
			}
			else {
				this.x_coord = 0;
			}
		},

        //0=meadow, 1=forest, 2=water, 3=wall, 4=bog, 5=swamp
        displayMap : function()
        {
            let tempMapString = "";
            for(let i = 0; i < MAX; i++)
            {
                for(let j = 0; j < MAX; j++ )
                {
                    let currCell = localStorage.getItem(j + ',' + i);
                    if(currCell != null)
                    {
                        currCell = currCell.split(",");
                        if(currCell[2] == '0')
                            tempMapString += 'X'
                        else if( j == this.x_coord && i == this.y_coord)
                            tempMapString += 'C'
                        else switch(currCell[3])
                        {
                            case '0':
                                tempMapString += 'M';
                                break;
                            case '1':
                                tempMapString += 'F';
                                break;
                            case '2':
                                tempMapString += 'w';
                                break;
                            case '3':
                                tempMapString += 'W';
                                break;
                            case '4':
                                tempMapString += 'B';
                                break;
                            case '5':
                                tempMapString += 'S';
                                break;
                            default:
                                tempMapString += 'E'; // 'E' signifies some sort of error when checking the cell
                                break;

                        }
                    }
                    else
                    {
                        tempMapString += 'X';
                    }
                }
                tempMapString += '\n';
            }
            this.mapString = tempMapString;
            document.getElementById("map").innerHTML = "MAP: " + '\n' + this.mapString;
            
        }
	};
</script>

<body>
<h1>Frupal - the game ...</h1>
<br><br>
<div style="width:25%;">
	<div>
	<div align="middle">
        <button onclick="game.go('n')" type="submit" form="form1" value="Submit">NORTH</button>
	</div>
	<div align="left">
		<button onclick="game.go('e')" style="float:right" type="submit" form="form1" value="Submit">EAST</button>
		<button onclick="game.go('w')" type="submit" form="form1" value="Submit">WEST</button>
	</div>
	<div align="middle">
		<button onclick="game.go('s')" type="submit" form="form1" value="Submit">SOUTH</button>
	</div>
</div>
<br><br><br>

<div><p id="loc">Current Location:  0,0</p> </div>
<div><p id="cell">Cell Details: </p> </div>
<div><p id="whif">Whiffles: </p> </div>
<div><p id="energy">Energy: </p> </div>
<div><p id="map"></P></div>

	<script>
		console.log(game.jewels.x + ',' + game.jewels.y);
		game.checkLoc(); //displaying the cell contents of the initial location.
	</script>

</body>

</html>
